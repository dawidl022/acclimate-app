<%= form_with(url: '/climate_ratings', method: :get) do |form| %>
  <fieldset class="sector-select">
    <legend>Sector</legend>
    <%= form.collection_radio_buttons(:category_id, Category.all, :id, :name) do |button| %>
      <div class="button">
        <%= button.radio_button %>
        <%= button.label %>
      </div>
    <% end %>

  </fieldset>
  <div class="field">
    <%= form.label :location %>
    <%= form.text_field :location %>
    <button type="button" id="current-location-btn">Use current location</button>
  </div>
  <div class="field">
    <%= form.label :radius, "Radius (km)" %>
    <%= form.number_field :radius, min: 0.1, step: 0.1, value: 1 %>
  </div>
  <%= form.submit 'Show Climate Ratings', name: nil %>
<% end %>

<% if @category_id %>
  <script>
    document.getElementById("category_id_<%= @category_id %>").checked = true;
    document.getElementById("radius").value = <%= @radius %>;
    document.getElementById("location").value = '<%= @location_name %>';
  </script>
<% end %>

<script>
    document.getElementById("current-location-btn").addEventListener("click", () => {
      navigator.geolocation.getCurrentPosition(pos => {
        document.getElementById("location")
          .value = `${pos.coords.latitude}, ${pos.coords.longitude}`
      }, fail => {
        if (document.querySelector("#device-location-error")) {
          return;
        }
        const errorElement = document.createElement('div');
        errorElement.classList.add("error");
        errorElement.setAttribute("id", "device-location-error");
        errorElement.textContent =
          "Unable to obtain current location. Please enter it manually"
        document.getElementById("location").parentNode.appendChild(errorElement);
      })
    })
</script>
